##### path to config file #####
configfile: "scripts/config/config.yaml",

##### load rules #####
rule all:
     input:
        expand("results/picard/{subsample}_trim_mapped_sorted_q2_nodup.bam", subsample = config["subsamples"]),
        expand("results/picard/{subsample}_trim_mapped_sorted_q2_nodup.bam.bai", subsample = config["subsamples"]),
        expand("results/picard/{subsample}_trim_mapped_sorted_q2_dups.txt", subsample = config["subsamples"]),
        expand("results/picard/{subsample}_trim_mapped_sorted_q2.log", subsample = config["subsamples"]),
        expand("results/macs2/{subsample}_trim_mapped_sorted_q2_nodup_model.r", subsample = config["subsamples"]),
        expand("results/macs2/{subsample}_trim_mapped_sorted_q2_nodup_peaks.narrowPeak", subsample = config["subsamples"]),
        expand("results/macs2/{subsample}_trim_mapped_sorted_q2_nodup_peaks.xls", subsample = config["subsamples"]),
        expand("results/macs2/{subsample}_trim_mapped_sorted_q2_nodup_summits.bed", subsample = config["subsamples"])
rule macs2: 
     input:
        "results/picard/{subsample}_trim_mapped_sorted_q2_nodup.bam"
     output:
        "results/macs2/{subsample}_trim_mapped_sorted_q2_nodup_model.r",
        "results/macs2/{subsample}_trim_mapped_sorted_q2_nodup_peaks.narrowPeak",
        "results/macs2/{subsample}_trim_mapped_sorted_q2_nodup_peaks.xls",
        "results/macs2/{subsample}_trim_mapped_sorted_q2_nodup_summits.bed"
     conda:
        "envs/macs2.yaml"
     threads: 8
     log:
        "logs/macs2_{subsample}.log"
     message:
        "Executing Identification of DNA access sites on : {input}"
     shell:
        """
        mkdir -p results/macs2
        macs2 callpeak -f BAM -t {input} -n {output}  
        """ 
